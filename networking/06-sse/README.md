# Server-Sent Events (SSE)

## Что это такое
**Server-Sent Events (SSE)** — это спецификация HTML5, которая описывает однонаправленный канал передачи данных **от сервера к клиенту** через встроенный интерфейс `EventSource`.  
SSE использует **обычный HTTP-протокол** и автоматически поддерживает переподключение. Это делает его удобным решением для потоковых данных, когда двусторонняя связь не нужна.

---

## Отличие SSE от WebSocket

| Возможность        | WebSocket             | SSE (EventSource)     |
|--------------------|----------------------|-----------------------|
| Направление связи  | двустороннее         | только сервер → клиент |
| Тип данных         | бинарные и текстовые | только текст          |
| Протокол           | WS / WSS             | HTTP / HTTPS          |
| Переподключение    | вручную              | встроено              |
| Поддержка браузерами | все современные     | все, кроме IE         |

---

## Зачем использовать SSE
- Нужно только **одностороннее соединение** (например, обновление новостей, курс валют, метрики).  
- Не хочется реализовывать **свою логику переподключений**.  
- Хочется использовать **HTTP-инфраструктуру** (CDN, прокси, балансировщики) без проблем.  
- Формат данных текстовый (JSON) и бинарка не требуется.  

---

## Принцип работы

### На клиенте
Создаём подключение:

```js
const eventSource = new EventSource("/events");

eventSource.onmessage = (event) => {
  console.log("Новое сообщение:", event.data);
};

eventSource.addEventListener("customEvent", (event) => {
  console.log("Событие:", event.data);
});

// закрыть соединение
eventSource.close();
```

### На сервере
Ответ сервера должен иметь заголовок:

```
Content-Type: text/event-stream
```

Сообщения отправляются в формате:

```
data: Сообщение 1

data: Сообщение 2
id: 2

event: customEvent
data: Пользователь вошёл
```

Особенности формата:
- `data:` — тело сообщения (можно несколько строк подряд).  
- `id:` — идентификатор сообщения, браузер запоминает его и при переподключении отправляет в `Last-Event-ID`.  
- `event:` — тип события.  
- `retry:` — интервал переподключения в миллисекундах.  

---

## Полезные особенности
- **Автоматическое переподключение** (сервер может управлять через `retry:`).  
- **Идентификаторы сообщений (`id:`)** — позволяют не терять данные при реконнекте.  
- **Кросс-доменные запросы** работают как у `fetch` (нужны заголовки CORS).  
- Поддерживается опция `{ withCredentials: true }` для отправки cookies.  
- Свойство `readyState` у `EventSource`:  
  - `0` — CONNECTING  
  - `1` — OPEN  
  - `2` — CLOSED  

---

## Когда использовать SSE
✅ Подходит:
- Реал-тайм уведомления (новости, оповещения).  
- Стриминг данных (логирование, метрики).  
- Односторонние обновления, где не нужна отправка от клиента.  

❌ Лучше выбрать WebSocket, если:
- Нужен двусторонний обмен (чаты, коллаборативные редакторы).  
- Нужна поддержка бинарных данных.  
- Высокочастотные сообщения с минимальной задержкой.

---

## На собеседовании можно сказать
- «SSE проще WebSocket, работает по HTTP и встроено переподключение.»  
- «SSE отлично подходит для real-time уведомлений и потоков данных от сервера, где двусторонность не нужна.»  
- «Для чатов или игр я бы выбрал WebSocket, а для новостей или стриминга метрик — SSE.»  

